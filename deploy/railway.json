{
  "$schema": "https://railway.app/railway.schema.json",
  "name": "AI Perp DEX",
  "description": "AI-Native Perpetual Trading DEX",
  "services": [
    {
      "name": "api",
      "source": {
        "repo": "your-username/ai-perp-dex"
      },
      "builder": "Dockerfile",
      "buildConfig": {
        "dockerfilePath": "Dockerfile",
        "target": "api"
      },
      "deploy": {
        "startCommand": "uvicorn api.server:app --host 0.0.0.0 --port $PORT",
        "healthcheckPath": "/health",
        "healthcheckTimeout": 10,
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 3
      },
      "env": {
        "API_ENV": "production",
        "LOG_LEVEL": "INFO",
        "MAX_CONCURRENT_REQUESTS": "100",
        "RATE_LIMIT_PER_AGENT": "10",
        "GLOBAL_RATE_LIMIT": "500",
        "PYTHONPATH": "/app/trading-hub",
        "REDIS_URL": {
          "type": "reference",
          "reference": "redis.REDIS_URL"
        },
        "JWT_SECRET": {
          "type": "secret"
        }
      },
      "networking": {
        "ports": [
          {
            "port": 8082,
            "protocol": "HTTP",
            "public": true
          }
        ]
      },
      "resources": {
        "replicas": 1,
        "sleepApplication": false,
        "limits": {
          "memory": "512Mi",
          "cpu": "0.5"
        }
      }
    },
    {
      "name": "redis",
      "source": {
        "image": "redis:7-alpine"
      },
      "deploy": {
        "startCommand": "redis-server --appendonly yes --maxmemory 128mb --maxmemory-policy allkeys-lru"
      },
      "networking": {
        "ports": [
          {
            "port": 6379,
            "protocol": "TCP",
            "public": false
          }
        ]
      },
      "volumes": [
        {
          "mount": "/data",
          "name": "redis-data"
        }
      ]
    },
    {
      "name": "frontend",
      "source": {
        "repo": "your-username/ai-perp-dex"
      },
      "rootDir": "frontend",
      "builder": "nixpacks",
      "deploy": {
        "startCommand": "npm start",
        "healthcheckPath": "/",
        "healthcheckTimeout": 10
      },
      "env": {
        "NEXT_PUBLIC_API_URL": {
          "type": "reference",
          "reference": "api.RAILWAY_PUBLIC_URL"
        },
        "NEXT_PUBLIC_WS_URL": {
          "type": "template",
          "template": "wss://{{api.RAILWAY_PUBLIC_DOMAIN}}/ws"
        }
      },
      "networking": {
        "ports": [
          {
            "port": 3000,
            "protocol": "HTTP",
            "public": true
          }
        ]
      }
    }
  ],
  "plugins": [
    {
      "name": "redis",
      "type": "redis"
    }
  ]
}
